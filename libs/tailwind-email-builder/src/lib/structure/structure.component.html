<ng-container ngForm>
  @for (column of currentStructure().elements; track $index) {
    <div [ngStyle]="$index | ipColumnStyles: currentStructure().options" cdkDropList [ipColumnDrop]="$index" [ipColumnStructure]="index()" [class.empty]="!column.length">
      {{ index() }} / {{$index}}
      @for (block of column; track block.id) {
        <div class="relative group" cdkDrag [cdkDragData]="block">
          <div class="overflow" *ipColumnBlock="block; let ins" (click)="ins.edit()">
<!--            @if (ins | ipCan: 'duplicate') {-->
<!--              <button class="tool-button" (click)="duplicateBlock($event, ins, column)">-->
<!--                <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" viewBox="0 0 20 20" fill="currentColor">-->
<!--                  <path d="M7 9a2 2 0 012-2h6a2 2 0 012 2v6a2 2 0 01-2 2H9a2 2 0 01-2-2V9z" />-->
<!--                  <path d="M5 3a2 2 0 00-2 2v6a2 2 0 002 2V5h8a2 2 0 00-2-2H5z" />-->
<!--                </svg>-->
<!--              </button>-->
<!--            }-->
            <button class="tool-button cursor-move" cdkDragHandle>
              <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd"
                      d="M9 3a1 1 0 012 0v5.5a.5.5 0 001 0V4a1 1 0 112 0v4.5a.5.5 0 001 0V6a1 1 0 112 0v5a7 7 0 11-14 0V9a1 1 0 012 0v2.5a.5.5 0 001 0V4a1 1 0 012 0v4.5a.5.5 0 001 0V3z"
                      clip-rule="evenodd" />
              </svg>
            </button>
<!--            @if (ins | ipCan: 'delete') {-->
<!--              <button class="tool-button text-red-700/75" (click)="removeBlock($event, ins, column)">-->
<!--                <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" viewBox="0 0 20 20" fill="currentColor">-->
<!--                  <path fill-rule="evenodd"-->
<!--                        d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z"-->
<!--                        clip-rule="evenodd" />-->
<!--                </svg>-->
<!--              </button>-->
<!--            }-->
          </div>
        </div>
      }
    </div>
  }

  <!--Structure tool buttons-->
  <div
    class="absolute top-0 right-0 opacity-0 group-hover:opacity-100 group-hover:z-20 transition-opacity bg-white p-1 shadow-lg rounded border-[1px] gap-2 flex">
    @if (currentStructure() | ipCan: 'edit') {
      <button class="tool-button" (click)="edit()">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" viewBox="0 0 20 20" fill="currentColor">
          <path
            d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" />
        </svg>
      </button>
    }
    <button class="tool-button cursor-move" cdkDragHandle>
      <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd"
              d="M9 3a1 1 0 012 0v5.5a.5.5 0 001 0V4a1 1 0 112 0v4.5a.5.5 0 001 0V6a1 1 0 112 0v5a7 7 0 11-14 0V9a1 1 0 012 0v2.5a.5.5 0 001 0V4a1 1 0 012 0v4.5a.5.5 0 001 0V3z"
              clip-rule="evenodd" />
      </svg>
    </button>
  </div>

  <!--Structure settings-->
  <tail-structure-settings *ipEmailBuilderSettings [index]="index()">
    <h2 tailH2 i18n="@@structure_actions">Actions</h2>
    <div class="flex gap-1">
      @if (currentStructure() | ipCan: 'duplicate') {
        <button class="text-black/75" tailBtn tailTooltip="Duplicate" i18n-tailTooltip="@@structure_duplicate"
                (click)="duplicateSelf()">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
            <path d="M7 9a2 2 0 012-2h6a2 2 0 012 2v6a2 2 0 01-2 2H9a2 2 0 01-2-2V9z" />
            <path d="M5 3a2 2 0 00-2 2v6a2 2 0 002 2V5h8a2 2 0 00-2-2H5z" />
          </svg>
        </button>
      }
      @if (currentStructure() | ipCan: 'delete') {
        <button class="text-red-700/75" tailBtn tailTooltip="Delete" i18n-tailTooltip="@@structure_delete"
                (click)="removeSelf()">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd"
                  d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z"
                  clip-rule="evenodd" />
          </svg>
        </button>
      }
    </div>
  </tail-structure-settings>
</ng-container>
